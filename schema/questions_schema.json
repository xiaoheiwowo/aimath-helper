{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "数学题目库Schema",
  "description": "定义数学题目库的JSON结构规范",
  "type": "object",
  "properties": {
    "questions": {
      "type": "array",
      "description": "题目列表",
      "items": {
        "$ref": "#/definitions/question"
      }
    }
  },
  "required": ["questions"],
  "definitions": {
    "question": {
      "type": "object",
      "description": "单个题目",
      "properties": {
        "id": {
          "type": "string",
          "description": "题目唯一标识符",
          "pattern": "^qu_[a-f0-9-]{36}$"
        },
        "type": {
          "type": "string",
          "description": "题目类型",
          "enum": ["choice", "calculation"]
        },
        "metadata": {
          "type": "object",
          "description": "题目元数据",
          "properties": {
            "category": {
              "type": "string",
              "description": "题目分类",
              "pattern": "^\\d+\\.(choice|cal)$"
            }
          },
          "required": ["category"]
        },
        "question": {
          "type": "string",
          "description": "题目内容",
          "minLength": 1
        },
        "knowledge_points": {
          "type": "array",
          "description": "知识点列表",
          "items": {
            "$ref": "#/definitions/knowledge_point"
          },
          "minItems": 1
        },
        "choices": {
          "type": "array",
          "description": "选择题选项（仅选择题有此字段）",
          "items": {
            "$ref": "#/definitions/choice"
          },
          "minItems": 2,
          "maxItems": 6
        },
        "solution_steps": {
          "type": "array",
          "description": "解题步骤（仅计算题有此字段）",
          "items": {
            "$ref": "#/definitions/solution_step"
          },
          "minItems": 1
        },
        "answer": {
          "type": "string",
          "description": "题目答案",
          "minLength": 1
        }
      },
      "required": ["id", "type", "metadata", "question", "knowledge_points", "answer"],
      "oneOf": [
        {
          "properties": {
            "type": { "const": "choice" },
            "choices": { "type": "array" }
          },
          "required": ["choices"]
        },
        {
          "properties": {
            "type": { "const": "calculation" },
            "solution_steps": { "type": "array" }
          },
          "required": ["solution_steps"]
        }
      ]
    },
    "knowledge_point": {
      "type": "object",
      "description": "知识点",
      "properties": {
        "outline": {
          "type": "string",
          "description": "知识点大纲",
          "minLength": 1
        },
        "detail": {
          "type": "string",
          "description": "知识点详细说明",
          "minLength": 1
        }
      },
      "required": ["outline", "detail"]
    },
    "choice": {
      "type": "object",
      "description": "选择题选项",
      "properties": {
        "id": {
          "type": "string",
          "description": "选项标识符",
          "pattern": "^[A-F]$"
        },
        "content": {
          "type": "string",
          "description": "选项内容",
          "minLength": 1
        },
        "is_correct": {
          "type": "boolean",
          "description": "是否为正确答案"
        },
        "explanation": {
          "type": "string",
          "description": "选项解释说明",
          "minLength": 1
        }
      },
      "required": ["id", "content", "is_correct", "explanation"]
    },
    "solution_step": {
      "type": "object",
      "description": "解题步骤",
      "properties": {
        "step": {
          "type": "string",
          "description": "步骤内容",
          "minLength": 1
        }
      },
      "required": ["step"]
    }
  }
}
