# AIMath Helper - 智能数学练习助手

一个基于AI的完整数学练习教学系统，支持智能出题、学生答题、自动批改、错误分析和针对性练习生成。专为数学教师和学生设计，提供个性化的学习体验。

## ✨ 功能特性

### 🎯 核心功能
- **🤖 AI 驱动的智能出题**：基于知识点自动生成高质量数学题目
- **📝 多题型支持**：选择题和计算题两种题型，满足不同练习需求
- **📷 智能OCR识别**：准确识别学生手写答题内容，支持复杂数学公式
- **✅ 自动批改系统**：智能批改选择题和计算题，提供详细步骤分析
- **📊 错误分析报告**：深度分析学生错误模式，统计薄弱知识点
- **🎯 针对性练习**：根据错误分析自动生成个性化练习题目

### 🛠️ 技术特性
- **📁 完整会话管理**：支持多会话并行，历史记录完整保存
- **🎨 现代化界面**：基于Gradio的直观Web界面，操作简单
- **⚡ 实时计算**：错误分析实时计算，数据始终最新
- **🔧 模块化设计**：代码结构清晰，易于扩展和维护

## 🚀 快速开始

### 环境要求

- Python 3.8+
- 阿里云通义千问API密钥
- 8GB+ 内存推荐

### 1. 克隆项目

```bash
git clone <repository-url>
cd aimath-helper
```

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 配置环境变量

创建 `.env` 文件并填入您的配置：

```bash
# 阿里云通义千问API配置
OPENAI_API_KEY=your_OPENAI_API_KEY_here

# 数据存储目录（可选，默认为./data）
DATA_DIR=./data

# 服务器配置（可选）
HOST=0.0.0.0
PORT=7860
```

### 4. 运行程序

```bash
python run.py
```

程序将在 `http://localhost:7860` 启动，在浏览器中打开即可使用。

### 5. 首次使用

1. 在"出题要求"输入框中输入您的需求，例如：
   - "生成关于有理数加法的练习题目"
   - "七年级数学第二章练习题"
   - "包含选择题和计算题的混合练习"

2. 点击"生成题目"按钮，系统将自动生成练习试卷

3. 上传学生答题图片，系统将自动识别和批改

## 📖 使用指南

### 🔄 完整工作流程

#### 1️⃣ 生成练习题目
- **输入要求**：在"出题要求"框中描述您的需求
  - 示例："生成关于有理数加法的练习题目"
  - 示例："七年级数学第二章练习题，包含选择题和计算题"
- **智能提取**：系统自动分析并提取相关知识点
- **题目生成**：从题库中智能选择题目，生成完整练习试卷
- **预览确认**：查看生成的题目，确认符合要求

#### 2️⃣ 学生答题
- **完成练习**：学生完成纸质练习
- **拍照上传**：使用手机或相机拍摄答题图片
- **批量上传**：支持一次上传多张图片
- **智能识别**：系统自动识别手写内容和数学公式

#### 3️⃣ 自动批改
- **选择题批改**：自动判断答案正确性
- **计算题分析**：逐步骤分析解题过程
- **详细反馈**：生成包含错误原因和正确解法的批改报告
- **分数统计**：自动计算得分和正确率

#### 4️⃣ 错误分析
- **模式识别**：分析学生的错误模式和规律
- **知识点统计**：统计错误最多的知识点
- **薄弱环节**：识别学生的知识薄弱点
- **分析报告**：生成详细的错误分析报告

#### 5️⃣ 针对性练习
- **智能推荐**：根据错误分析推荐重点练习内容
- **个性化出题**：针对薄弱知识点生成专项练习
- **循环改进**：通过多轮练习持续提升学习效果

### 🎯 使用技巧

#### 出题技巧
- **明确描述**：详细描述出题要求，包括知识点、难度、题型等
- **分层次练习**：可以分基础、提高、综合等不同层次出题
- **知识点组合**：可以要求多个知识点的综合练习

#### 批改技巧
- **图片质量**：确保答题图片清晰，字迹工整
- **分题上传**：复杂题目可以分题拍照上传
- **检查识别**：上传后检查OCR识别结果是否准确

#### 分析技巧
- **关注模式**：重点观察学生的错误模式，而非单个错误
- **知识点关联**：注意相关知识点之间的关联性
- **个性化指导**：根据分析结果制定个性化学习计划

## 📁 数据管理

### 存储结构
- **数据目录**：所有数据保存在 `data/` 目录下
- **会话命名**：使用 `ID_时间戳` 格式（如：`8af101c1_20250925_144208`）
- **文件组织**：每个会话包含独立的数据文件夹

### 会话数据
每个会话文件夹包含：
- **`session_data.json`**：完整会话数据
  - 出题要求和知识点
  - 练习题目和答案
  - 学生答题数据
  - 批改结果和分数
- **`images/`**：学生答题图片
  - 支持多种图片格式（JPG、PNG等）
  - 自动重命名和分类存储

### 数据安全
- **本地存储**：所有数据存储在本地，保护隐私
- **备份建议**：定期备份 `data/` 目录
- **版本控制**：支持多版本会话管理

## 🏗️ 项目架构

### 目录结构
```
aimath-helper/
├── 📁 data/                    # 数据存储目录
│   └── 📁 session_*/           # 会话数据文件夹
├── 📁 src/                     # 源代码目录
│   ├── 🤖 ai.py               # AI处理核心模块
│   ├── 🎨 complete_ui.py      # 完整用户界面
│   ├── 📚 question/           # 题库管理模块
│   │   ├── bank.py            # 题库管理器
│   │   ├── model.py           # 数据模型定义
│   │   └── questions.json     # 题目数据库
│   ├── 📝 practice/           # 练习管理模块
│   │   ├── practice.py        # 练习管理器
│   │   ├── template.py        # 模板渲染器
│   │   └── practice_example.json
│   ├── 💾 session.py          # 会话管理模块
│   ├── 🧠 knowledge_base.py   # 知识点数据库
│   └── 🔧 handlers.py         # 业务逻辑处理器
├── 📁 schema/                  # 数据模式定义
│   ├── question_models.py     # 题目数据模型
│   ├── questions_schema.json  # 题目模式定义
│   └── validate_questions.py  # 数据验证工具
├── 📁 docs/                    # 文档目录
├── 📄 requirements.txt        # 依赖包列表
├── 🚀 run.py                  # 程序入口
├── 📖 README.md               # 项目说明
└── 📋 USAGE.md                # 使用说明
```

### 核心模块

#### 🤖 AI处理模块 (`ai.py`)
- **知识点提取**：从文本中智能提取数学知识点
- **题目生成**：基于知识点生成练习题目
- **OCR识别**：识别学生手写答题内容
- **自动批改**：智能批改选择题和计算题
- **错误分析**：分析学生错误模式和薄弱点

#### 🎨 用户界面 (`complete_ui.py`)
- **Gradio界面**：现代化的Web用户界面
- **交互功能**：文件上传、实时预览、结果展示
- **会话管理**：多会话并行处理
- **数据展示**：格式化显示分析结果

#### 📚 题库管理 (`question/`)
- **题目存储**：结构化的题目数据库
- **题型支持**：选择题和计算题
- **知识点关联**：题目与知识点的映射关系
- **数据验证**：确保题目数据的完整性

#### 📝 练习管理 (`practice/`)
- **练习生成**：根据知识点生成练习试卷
- **模板渲染**：使用Jinja2模板生成题目
- **格式转换**：支持多种输出格式
- **个性化定制**：支持自定义练习参数

## 🔧 技术栈

### 核心依赖
- **Gradio** (4.x)：现代化Web界面框架
- **OpenAI** (1.x)：AI API客户端，支持通义千问
- **Jinja2** (3.x)：模板引擎，用于题目渲染
- **Pillow** (10.x)：图像处理库，支持OCR预处理

### 开发工具
- **python-dotenv**：环境变量管理
- **json**：数据序列化和反序列化
- **datetime**：时间处理
- **os/pathlib**：文件系统操作

### AI服务
- **通义千问**：大语言模型，用于文本理解和生成
- **Qwen-VL**：视觉语言模型，用于OCR识别

## 🚀 部署指南

### 本地部署
1. 按照快速开始指南安装和配置
2. 确保API密钥配置正确
3. 运行 `python run.py` 启动服务

### 服务器部署
1. 安装生产环境依赖
2. 配置反向代理（Nginx推荐）
3. 设置SSL证书（HTTPS推荐）
4. 配置防火墙和安全策略

### Docker部署（可选）
```dockerfile
FROM python:3.9-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
EXPOSE 7860
CMD ["python", "run.py"]
```

## 🤝 贡献指南

### 开发环境
1. Fork项目到您的GitHub账户
2. 克隆项目到本地
3. 创建新的功能分支
4. 提交代码并创建Pull Request

### 代码规范
- 遵循PEP 8 Python代码规范
- 添加适当的注释和文档字符串
- 编写单元测试（推荐）
- 确保代码通过linting检查

### 问题报告
- 使用GitHub Issues报告问题
- 提供详细的错误信息和复现步骤
- 包含系统环境信息

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 🙏 致谢

感谢所有贡献者和开源社区的支持，特别感谢：
- Gradio团队提供的优秀UI框架
- 阿里云通义千问团队提供的AI服务
- 所有参与测试和反馈的用户

---

**如有问题或建议，欢迎提交Issue或联系维护者。**